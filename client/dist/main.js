!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){const n=["yellow","red","blue","orange","teal","purple","lightgreen"],o=L.tileLayer("https://mw1.google.com/mw-planetary/sky/skytiles_v1/{x}_{y}_{z}.jpg"),r=L.tileLayer("https://www.cadc-ccda.hia-iha.nrc-cnrc.gc.ca/data/pub/GSKY/M.{x}.{y}.{z}.png");document.addEventListener("DOMContentLoaded",(async function(){await v(),await p(),M.Collapsible.init(document.querySelectorAll(".collapsible")),M.Tabs.init(document.getElementById("query-tab")),M.Sidenav.init(document.querySelectorAll(".sidenav")),M.updateTextFields()}));L.layerGroup([o,r]);let l=L.map("map-container",{center:[10.425,-7.037387],zoom:6,minZoom:5,maxZoom:14,selectArea:!0,layers:[o,r],renderer:L.canvas()});l.on("areaselected",e=>{selectionBounds=e.bounds.toBBoxString(),a(selectionBounds)});const a=e=>{alert("this should popup with available fits files for "+e)};let i=L.marker([0,0],{opacity:0,icon:(c="yellow",new L.Icon({iconUrl:`https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${c}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}))}).addTo(l);var c;let d={GoogleSky:o,NGVSTile:r},s=L.control.layers(null,d,{collapsed:!1});s.addTo(l);const u=e=>{i.setLatLng((e=>{let t=e.Dec,n=e.RA;return n>180&&(n=180-n),L.latLng([t,n])})(e)),i.setOpacity(1)};L.control.mousePosition({position:"bottomright",separator:" | ",lngFormatter:e=>(e<0&&(e=-1*e+180),L.Util.formatNum(e,3)),latFormatter:e=>L.Util.formatNum(e,3)}).addTo(l),L.control.mousePosition({position:"bottomright",separator:" | ",lngFormatter:e=>{e<0&&(e=-1*e+180);var t=Math.floor(e/15),n=Math.floor(60*(e/15-t)),o=Math.floor(3600*t-60*n),r=Math.floor(100*(3600*t-60*n-o));return("00"+t).slice(-2)+":"+("00"+n).slice(-2)+":"+("00"+o).slice(-2)+"."+r},latFormatter:e=>{var t=Math.floor(e),n=Math.abs(e-t),o=Math.floor(60*n),r=Math.floor(3600*n-60*o),l=Math.floor(10*(3600*n-60*o-r));return("00"+t).slice(-2)+":"+("00"+o).slice(-2)+":"+("00"+r).slice(-2)+"."+l}}).addTo(l);const m=document.getElementById("search-form");m.addEventListener("submit",e=>{e.preventDefault();const t=new FormData(m);m.reset(),fetch("http://127.0.0.1:5000/coordinates",{method:"post",body:t}).then(e=>e.json()).then(e=>{u(e)}).catch(e=>{i.setOpacity(0)})});const p=async()=>{fetch("http://127.0.0.1:5000/overlays").then(e=>e.json()).then(e=>{let t=0,o=L.control.layers(null,null,{collapsed:!1});for(const[r,l]of Object.entries(e)){let e=l,a=L.layerGroup();const i=n[t];t++;L.polygon(e,{color:i,fillOpacity:0}).addTo(a),o.addOverlay(a,r)}o.addTo(l)})},b=e=>{const t=document.getElementById("query-tab-select-menu");let n=document.createElement("option");n.setAttribute("value",e),n.innerHTML=e,t.appendChild(n),M.FormSelect.init(t)},h=()=>{let e=document.getElementById("query-tab-select-menu").value,t=document.getElementsByClassName("refine-form");for(div of t)div.classList.add("hide"),div.id===e+"-form"&&div.classList.remove("hide")},f=e=>{let t=document.createElement("div");t.setAttribute("class","col s12");let n=document.createElement("input");n.setAttribute("type","range"),n.setAttribute("min","100"),n.setAttribute("max","5000"),n.setAttribute("value","500"),n.setAttribute("id",e+"-markerSizeSlider");let o=document.createElement("label");return o.setAttribute("for",e+"-markerSizeSlider"),o.innerHTML="Marker Size",t.appendChild(n),t.appendChild(o),t},y=(e,t)=>{let n=document.createElement("div");n.setAttribute("class","input-field col s6");let o=document.createElement("input");o.setAttribute("name",t),o.setAttribute("type","text"),o.setAttribute("id",`${e}-${t}`);let r=document.createElement("label");return r.setAttribute("for",`${e}-${t}`),r.innerHTML=""+t.slice(9),n.appendChild(r),n.appendChild(o),n},g=(e,t,n)=>{let o=document.createElement("div");o.setAttribute("class","col s12 refine-btns");let r=document.createElement("button");r.innerText="apply",r.setAttribute("class","btn-small"),r.setAttribute("name","apply");let l=document.createElement("input");l.setAttribute("value","download"),l.setAttribute("type","button"),l.setAttribute("class","btn-small orange lighten-2"),l.addEventListener("click",()=>E(e,t));let a=document.createElement("input");return a.setAttribute("type","button"),a.setAttribute("value","clear"),a.setAttribute("class","btn-small red lighten-2"),a.addEventListener("click",()=>A(e,n)),o.appendChild(r),o.appendChild(l),o.appendChild(a),o},v=async()=>{const e=await w(),t=document.getElementById("query-tab-body");(()=>{const e=document.getElementById("query-tab-select-menu");let t=document.createElement("option");t.setAttribute("disabled",!0),t.setAttribute("selected",!0),t.setAttribute("value",""),t.innerText="Select Catalog",e.appendChild(t),e.addEventListener("change",h),M.FormSelect.init(e)})();let o=0;for(catalog of e){const e=n[o],r=catalog.name;b(r);let l=L.layerGroup(),a=document.createElement("form");for(principleColumn of(a.setAttribute("id",r+"-form"),a.setAttribute("class","refine-form hide row"),a.addEventListener("submit",t=>{const n=new FormData(a);t.preventDefault(),fetch(`http://127.0.0.1:5000/catalogs/${r}/query`,{method:"post",body:n}).then(e=>e.json()).then(t=>{l.clearLayers();let n=document.getElementById(r+"-markerSizeSlider").value;s.removeLayer(l),s.addOverlay(l,r);for(let[o,a]of Object.entries(t)){let t=L.circle(a,{radius:n,color:e,weight:1});t.bindTooltip(`${o} (${r})`),t.on("click",()=>S(r,o)),t.addTo(l)}})}),a.appendChild(f(r)),catalog.principleColumns))a.appendChild(y(r,principleColumn));a.appendChild(g(r,a,l)),t.appendChild(a),o++}M.updateTextFields()},E=(e,t)=>{const n=new FormData(t);fetch(`http://127.0.0.1:5000/catalogs/${e}/download`,{method:"post",body:n}).then(e=>e.text()).then(t=>{let n=Date.now(),o=new Blob([t]),r=document.createElement("a");r.href=window.URL.createObjectURL(o),r.download=`${e}-${n}.csv`,r.click()})},A=(e,t)=>{document.getElementById(e+"-form").reset(),s.removeLayer(t),t.clearLayers()},w=async()=>(await fetch("http://127.0.0.1:5000/catalogs")).json(),S=(e,t)=>{fetch(`http://127.0.0.1:5000/catalogs/${e}/query_object/${t}`).then(e=>e.json()).then(e=>{let n=document.getElementById("object-modal");document.getElementById("modal-object-name").innerText=t;const o=M.Modal.init(n,{dismissible:!0}),r=document.getElementById("object-table-body");for(let[t,n]of Object.entries(e)){const e=document.createElement("tr"),o=document.createElement("th");o.innerHTML=t;const l=document.createElement("th");l.innerHTML=n,e.appendChild(o),e.appendChild(l),r.appendChild(e)}o.open()})}}]);